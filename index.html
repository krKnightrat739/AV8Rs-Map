<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AV8Rs Live Planespotter Map (Realtime)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Arial, Helvetica, sans-serif; background:#000; color:#fff; }
    header { display:flex; align-items:center; gap:10px; padding:10px 14px; background:#0b1220; font-weight:bold; }
    header img { height:30px; }
    #container { display:flex; height:calc(100vh - 50px); }
    #sidebar { width:240px; background:rgba(0,0,0,0.8); padding:12px; overflow-y:auto; }
    @media (max-width:768px){ #sidebar{ width:170px; font-size:13px; } }
    h3{ margin:10px 0 6px; font-size:14px; border-bottom:1px solid #333; padding-bottom:4px; }
    .aircraft{ background:#111; padding:6px; border-radius:5px; margin-bottom:6px; font-size:13px; }
    input,button{ width:100%; margin-bottom:6px; padding:7px; border-radius:4px; border:none; }
    button{ background:#1e90ff; color:#fff; font-size:14px; }
    #map{ flex:1; }
  </style>
</head>
<body>

<header>
  <img src="logo.png" alt="Logo" />
  AV8Rs Bangladesh â€“ Live Realtime Spotter Map
</header>

<div id="container">
  <div id="sidebar">
     <h1>Incoming Aircraft</h1>
     <h3>Aircrafts</h3>
         <div class="aircraft"><b>FORMATION 1</b> <br>âœˆ Grob 120TP <br>âœˆ L-410</div>
         <div class="aircraft"><b>FORMATION 2</b> <br>âœˆ F-7BGI <br>âœˆ F-7MB </div>
         <div class="aircraft"><b>FORMATION 3</b> <br>âœˆ PT-6 </div>
         <div class="aircraft"><b>FORMATION 4</b> <br>âœˆ 5x K-8W </div>
         <div class="aircraft"><B>Paratroops </B> <BR>âœˆ C-130</div>
         <div class="aircraft"><B>NAVY </B> <BR>âœˆ D228</div>
            <div class="aircraft"><B>ARMY </B> <br>âœˆ Cessna 152 <br>âœˆ C295</div>
         <div class="aircraft"><B>FINAL </B> <BR>âœˆ MIG29</div>
         <div class="aircraft"><B>HELICOPTERS </B> <BR>ğŸš Mil-171sh <br>ğŸš AW119 <br>ğŸš Bell 206 <br>ğŸš bell 407GXI <br>ğŸš AW109 </div>


    <h3>Add Spotter (Realtime)</h3>
    <input id="name" placeholder="Name" />
    <input id="phone" placeholder="Phone" />
    <input id="device" placeholder="Device" />
    <button onclick="addSpotter()">Add / Update My Location</button>
  </div>
  <div id="map"></div>
</div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ğŸ”´ FIREBASE CONFIG (PASTE YOUR OWN KEYS HERE)
  const firebaseConfig = {
  apiKey: "AIzaSyAE0_p2bn403dar1-rs1GHckc47vlC94r8",
  authDomain: "av8rs-live-map.firebaseapp.com",
  databaseURL: "https://av8rs-live-map-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "av8rs-live-map",
  storageBucket: "av8rs-live-map.firebasestorage.app",
  messagingSenderId: "676842892744",
  appId: "1:676842892744:web:1b33f35683002c5b97e4fd",
  measurementId: "G-0ZSBN241DF"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const spotterRef = db.ref('spotters');

  // MAP
  const map = L.map('map').setView([23.778047484729505, 90.38298729166861], 13);
  L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3']
  }).addTo(map);

  L.marker([23.778047484729505, 90.38298729166861])
    .addTo(map)
    .bindPopup('ğŸ“ Event Meet Point');

  const markers = {};

  // ADD / UPDATE SPOTTER
  function addSpotter(){
    if(!navigator.geolocation){ alert('GPS not supported'); return; }

    const name = document.getElementById('name').value || 'Unknown';
    const phone = document.getElementById('phone').value || 'N/A';
    const device = document.getElementById('device').value || 'N/A';
    const id = name.replace(/\s+/g,'_').toUpperCase();

    navigator.geolocation.getCurrentPosition(pos=>{
      spotterRef.child(id).set({
        name, phone, device,
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
        time: Date.now()
      });
    });
  }

  // REALTIME LISTENER
  spotterRef.on('value', snap=>{
    const data = snap.val();
    if(!data) return;

    Object.keys(data).forEach(id=>{
      const s = data[id];
      if(markers[id]){
        markers[id].setLatLng([s.lat, s.lng]);
      } else {
        markers[id] = L.marker([s.lat, s.lng]).addTo(map)
          .bindPopup(`âœˆ ${s.name}<br>ğŸ“ ${s.phone}<br>ğŸ“± ${s.device}<br><a href="https://www.google.com/maps?q=${s.lat},${s.lng}" target="_blank">Open in Google Maps</a>`);
      }
    });
  });
</script>
</body>
</html>
